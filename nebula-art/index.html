<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Whispers from the Nebula</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="dark light" />
  <meta name="description" content="Nebula art and interactive story experiment" />
  <link href="https://fonts.googleapis.com/css2?family=Kaushan+Script&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="nebula.css" />
</head>
<body>

  <!-- Canvas holder for the p5 sketch -->
  <div id="sketch-container"></div>

  <!-- Mode switch -->
  <div id="mode-switch" role="group" aria-label="Mode switch">
    <button class="btn" data-mode="whispers" type="button" aria-pressed="false">Whispers</button>
    <button class="btn active" data-mode="story" type="button" aria-pressed="true">Story</button>
  </div>

  <!-- Story UI overlay: now centered, transparent, inherits Whisper font -->
  <section id="story-ui">
    <div id="story-wrap">
      <h2 id="story-title"></h2>
      <p id="story-body"></p>
      <div id="story-choices"></div>
      <div id="story-path"></div>
      <div id="story-ending" class="sr-only" aria-live="polite"></div>
    </div>
  </section>

  <noscript>
    <div style="position:fixed;inset:0;display:grid;place-items:center;background:#111;color:#fff;z-index:2000;">
      <p>JavaScript is required for Whispers and Story mode</p>
    </div>
  </noscript>

  <!-- Scripts: p5 first, then your sketch, then engines, then wiring -->
  <script src="https://cdn.jsdelivr.net/npm/p5@1.9.3/lib/p5.min.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/dat.gui@0.7.9/build/dat.gui.min.js"></script>
 
  <!-- whispers.js is imported by sketch.js -->
  <script type="module" src="sketch.js"></script>
  <script src="story.js"></script>
  <script src="main.js"></script>

  <!-- Ripple effect: adds a soft ink ripple to any .btn -->
  <script>
    document.addEventListener("click", e => {
      const btn = e.target.closest(".btn");
      if (!btn) return;
      const ripple = document.createElement("span");
      ripple.className = "ripple";
      const rect = btn.getBoundingClientRect();
      ripple.style.left = (e.clientX - rect.left) + "px";
      ripple.style.top  = (e.clientY - rect.top)  + "px";
      btn.appendChild(ripple);
      ripple.addEventListener("animationend", () => ripple.remove());
    }, { capture: true });

    // Ensure Story UI uses the same font as the Whispers page
    window.addEventListener("DOMContentLoaded", () => {
      const bodyFont = getComputedStyle(document.body).fontFamily;
      document.getElementById("story-ui").style.fontFamily = bodyFont;
    });
  </script>
</body>
</html>
